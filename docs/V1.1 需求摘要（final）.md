# 需求摘要（final）— AI Content Workstation / AI_SPECDIGEST v1.1.0 (frozen)

- Spec version: **1.1.0**
- Status: **frozen**
- spec_sha256: **<SPEC_SHA256_TBD>**
- 变更策略：冻结后仅允许通过 **SPEC_CHANGE_REQUEST（CR-L1）→ Window-5 Change Coordinator** 修改。

---

## 1) 本版目标（面向后续架构/计划/开发）
在 v1.0.0 的“生成→审核→入库→追溯”闭环上，新增两项确定性能力，降低人物漂移与提示词不可追溯导致的返工：
1) **Generate 提示词链路冻结为三段：raw_input（必有）→ assembly_prompt（可选）→ final_prompt（必有）**  
2) **新增 Characters 角色库：以参考集确认 + 跨工作区选择 + 产物追溯，支撑人物一致性**

并明确 Settings 的“API 添加”策略：**前端开放配置实例（ProviderProfile），后端控制能力类型（ProviderType）**。

---

## 2) P0 范围（必须交付）
### Library（统一资产库）
- 全局展示所有图片+视频资产（来源含 Generate/Series/Projects）。
- 支持至少按：类型/来源/时间/状态（正常/回收站）的筛选或排序。
- 资产详情可追溯：PromptPack/Run/Review，以及（如有）Character/Series/Project/Shot 的引用关系。

### Generate（t2i/i2i/t2v/i2v）
- 支持四类生成入口；成功结果默认入库为 Asset。
- 提示词链路必须可追溯：raw_input、final_prompt；assembly_prompt 可选且缺省必须明确标记“未使用组装Prompt”。
- 生成可选择 0..N 角色（primary_character 默认 1 个），并写入可追溯关联。
- 失败生成必须保留记录与原因，允许重试。

### Review（量化 + 治理）
- 审核输出语义冻结：face_consistency_score / style_consistency_score / quality_score / overall_pass / reasons[]。
- 默认策略：自动通过 + 抽检（默认 5%）；人工覆写必须留因并可追溯。

### Trash（软删除 + 还原）
- 删除默认软删除进入回收站；回收站支持还原且不丢失追溯关联。

### Characters（角色库）
- 角色参考集与确认状态：draft/confirmed/archived。
- confirmed 最小门槛（冻结）：≥8 张参考图（角度覆盖 + 表情/光照覆盖），推荐 12 张；可选短视频补充。
- Generate 中可选择已确认角色；产物可追溯到角色与参考集版本。
- Series/Projects 可引用角色（需求层至少要求可选择与可追溯显示）。

---

## 3) P1 范围（增强）
### Settings（ProviderProfile + 语言/主题）
- ProviderProfile（配置实例）由用户在 Settings 新增/编辑/设默认/删除。
- ProviderType（能力类型）由后端控制并提供“支持清单 + 配置项语义描述”；前端据此渲染表单。
- 默认继承：全局默认 → 工作区默认 → 单次生成覆写（覆写不反写默认）。
- 双语：zh-CN/en-US；主题/密度：Light/Dark × Comfortable/Compact。

---

## 4) 关键验收（节选）
- AC-001/002：Library 总览与资产详情追溯成立。
- AC-003：四类生成入口可发起生成且默认入库可追溯。
- AC-004：审核量化输出 + 抽检 + 覆写留痕成立。
- AC-007：角色确认后可在 Generate 选择并生成，产物可追溯到角色与参考集版本。
- AC-008：提示词链路可追溯且 assembly_prompt 缺省有明确标记。
- AC-009：回收站还原不丢失追溯关联。
- AC-010：Settings 可新增 ProviderProfile；ProviderType 由后端控制；默认继承与覆写成立。

---

## 5) 下游窗口必须接收（硬约束）
- spec_version = **1.1.0**
- status = **frozen**
- spec_sha256 = **<SPEC_SHA256_TBD>**
