总的命令规则（粘贴执行版）
规则 G0：先固定 PY（强制虚拟环境）

每个命令块开头都要解析 PY（优先 apps/api/.venv/.../python.exe）。

后续所有 python 调用一律用 "$PY"，禁止裸 python。

规则 G1：严禁在顶层交互终端直接 set -e

需要 fail-fast 时，把严格逻辑放进子 shell：
(... ) 内部可以 set -euo pipefail，失败只会结束子 shell，不会杀掉终端。

规则 G2：SAFE 与 STRICT 两种模式明确区分

STRICT（修改代码/回归验证）：失败就停止后续步骤，但不退出终端（用子 shell）。

SAFE（巡检/收集日志）：失败不停止，继续跑完并汇总；所有错误照样打印。

规则 G3：所谓“吞掉失败”=“不中断流程，但不隐藏错误”

命令本身的 stderr/stdout 照常输出（所以你看得到完整报错）。

只是把返回码记录下来，不让它触发 set -e 或不让整段停止。

规则 G4：禁止 curl | python 直接管道解析

必须先落盘：curl -D hdr -o body -w http_code

再用 "$PY" 解析文件；解析失败只打印 [err]，不“炸”掉整个终端。