# TASK_ASSIGNMENT.md (v1.1.0, draft) — Dev Windows / Collaboration Boundaries

## 0) 指纹与冻结状态
- AI_SPECDIGEST v1.1.0 (frozen) sha256: `cc7c290224a37ef3b92bc797de37e8e0148e7107959c8e1bf3e5373aeabf51a3`
- ARCH_DIGEST v1.1.0 (frozen) sha256: `f83879ffdc5b1c191ad235cd046ebd28d008ba9677c45f554aebc60b4b0b9d00`
- This document sha256: `<TBD: computed by gate/CI>`, status: `draft`

## 1) 推荐 Dev Windows（按冲突域隔离）

### Window-A — Backend/Data Model Owner（data_model + api_routes）
- 负责 Steps：
  - `STEP-020`（migrations + schema）
  - `STEP-030`（/provider_types）
  - `STEP-040`（/provider_profiles* + 默认 + secrets 脱敏）
  - `STEP-050`（/characters* + ref_set 版本化 + >=8 门槛）
  - `STEP-060`（/runs 契约增强：prompt_pack + characters + provider evidence）
  - `STEP-070`（/assets/{id} trace 扩展）
- 交付要求：
  - OpenAPI 更新完整；分页 shape 统一；错误 envelope + request_id 全覆盖
  - PromptPack/Character/Provider 追溯链路通过 links 建立（Links 为 SSOT）
- 风险与边界：
  - 不改 IA 路由；不承担 UI 组件实现（避免 ui_components 冲突）

### Window-B — Frontend/UI Owner（ui_routes + ui_components）
- 负责 Steps：
  - `STEP-080`（/characters /settings 路由骨架）
  - `STEP-090`（Settings：ProviderProfiles 管理）
  - `STEP-100`（Characters：角色库 + ref_set + 引用资产选择）
  - `STEP-110`（Generate：PromptChain + Characters + Provider 继承/覆写）
  - `STEP-120`（Library/AssetDetail：筛选排序 + evidence chain 展示扩展）
- 交付要求：
  - IA lock 路由必须可访问（200）；App Shell 一致
  - API 错误展示必须带 request_id（从 error envelope 透传）
  - 兼容后端字段缺失的降级显示（避免后端回滚时 UI 崩溃）
- 风险与边界：
  - 不改后端契约字段名；不引入未注册 ProviderType（front-open/back-controlled）

### Window-C — Gates/Docs Owner（gates + docs）
- 负责 Steps：
  - `STEP-130`（新增/强化 gates + 更新 EVIDENCE/HANDOFF）
  - 协助：为 Window-A/B 提供可复用的门禁脚本框架与稳定性策略
- 交付要求：
  - v1.1 新增面必须有 machine-checkable gates（至少覆盖 AC-007/008/010）
  - docs/EVIDENCE_P0_FULL.md 按 AC 归档证据；docs/HANDOFF_P0_CUMULATIVE.md 可直接交接
- 风险与边界：
  - 不直接实现业务逻辑；只固化验证与交接结构

### Window-D — Integrator / Release Candidate Owner（cross-domain）
- 负责 Steps：
  - `STEP-140`（全量验收 + 回归 + RC 收口）
- 交付要求：
  - gate_all --mode=full 全绿
  - AC-001..AC-010 证据闭合；回滚锚点明确；已知风险与后续工作清单清晰
- 风险与边界：
  - 不引入大范围重构；只做集成修复、缺口补齐、文档收口

## 2) 协作协议（减少冲突与返工）
- 契约优先：
  - 后端先锁定字段名/分页 shape/error envelope；前端按契约消费
  - 任何新增 ProviderType 必须由后端注册表暴露后前端才可显示
- Link 为唯一真源：
  - 跨对象关系全部通过 Links 建立（Run→PromptPack / Run→Asset / Run→Character / Run→CharacterRefSet / RefSet→Asset）
- Secrets 处理红线：
  - secret 永不明文回显（API 与 UI 均遵守“已配置”状态）
- 回滚优先：
  - 每个 step 合并前必须能回到 last-green；前端必须具备字段缺失的容错降级

## 3) 每个窗口的最小交付包（必须可交接）
- 变更清单（冲突域归属 + 影响面）
- 验证命令（本窗口新增/更新的 gates）与预期输出
- 回滚说明（回到 last-green 的方式与注意事项）
- 若存在未完成项：明确阻塞点、可替代方案与下一窗口行动项

## 4) 里程碑（以 gates 为准）
- M0：preflight gates 绿（STEP-010）
- M1：迁移与 schema 绿（STEP-020）
- M2：Provider API 绿（STEP-030/040）
- M3：Characters API 绿（STEP-050）
- M4：Runs + AssetDetail trace 绿（STEP-060/070）
- M5：Settings/Characters UI 可操作（STEP-090/100）
- M6：Generate + Library/Detail 完整闭环（STEP-110/120）
- M7：full gates + docs 收口（STEP-130/140）
