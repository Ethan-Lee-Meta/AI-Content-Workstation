AI_SPECDIGEST:
  meta:
    artifact_id: spec-ai-content-workstation-<yyyymmdd>
    version: 1.1.0
    status: draft
    language: zh-CN
    created_at: <ISO8601>
    owners:
      primary: SpecAnalyst
      approver: User
    fingerprints:
      spec_sha256: <SPEC_SHA256_TBD>
      conversation_ref: '<optional: chat id / link / note>'
    change_policy:
      frozen_immutable: false
      change_level: CR-L1
      owner_window: ChangeCoordinator
      change_flow:
      - 发现需求问题或新增需求 -> 生成 SPEC_CHANGE_REQUEST.yaml
      - 提交至 Change Coordinator（窗口5）评估影响范围与传播路径
      - 批准后提升 version，并更新 spec_sha256
      note: draft 可编辑；冻结后不得口头修改；以版本化变更为唯一通道
  human_readable_doc:
    executive_summary:
      core_value: 在单机单用户环境下，实现 AI 图/视频“可组装提示词→可选角色库→生成→量化审核→资产入库→证据链追溯→（可选）Series/Project
        组织”的闭环，并优先保证人物一致性与风格一致性可控。
      target_users: 需要高频生成与复用 AI 图片/视频素材的个人创作者/制片人/内容管线搭建者（单机单用户）。
      key_differentiators:
      - 提示词可追溯链：原始输入→（可选）组装Prompt→最终Prompt→Run→Review→Asset 的证据链可反向定位
      - 角色库（Character）作为一致性资产：用结构化参考集进行人物确认与复用，降低跨生成漂移
      - 量化审核：face/style/quality 分数 + overall_pass，支持自动通过+抽检与人工覆写留痕
      - 可携带交付（仍为未来/可选）：可加密目录包，支持无导入预览与导入迁移（关系与证据链一致）
    problem_statement: 生成素材分散、角色脸/风格不稳定、审核口径不统一、复用困难、交付/迁移缺乏可追溯证据链。
    solution_statement: 以“资产库+关系管理+审核量化+证据链”为核心组织生成与复用；以Shot为单位做素材编排（仅引用关系）；支持加密导出与迁移。
    non_goals_highlight:
    - 不做：多用户/权限/RBAC/协作
    - 不做：NLE剪辑合成（转场/字幕/音轨/时间线渲染）
    - 不做：模型训练/微调/LoRA训练管理
    - 不做：云端同步/共享资产库（本期）
    - 本规范不定义：数据库表结构、API字段名、具体库版本、路由/接口细节
    glossary:
    - term: Asset
      definition: 系统管理的产出物（图片/视频）及其最小元数据与关联信息。
    - term: PromptPack
      definition: 一次生成前由系统组装的提示词/输入集合的不可变快照（复制编辑产生新版本）。
    - term: Run
      definition: 一次生成执行记录（包含输入引用、provider/workflow引用、状态与结果摘要）。
    - term: Review
      definition: 对生成结果的质量/一致性审核记录（含分数、结论与原因）。
    - term: Character
      definition: 可复用的角色档案（含参考图片/视频与确认状态），用于生成时的人物一致性约束与追溯。
    - term: Evidence Chain
      definition: 从输入到输出的可追溯记录：PromptPack/Run/Review/Asset等之间的关联链路。
    - term: Project
      definition: 资产归类的顶层维度（可选；默认允许为空）。
    - term: Series
      definition: 项目内的系列维度（可选；用于分组与编排）。
    - term: Shot
      definition: 分镜头/顺序单元，用于按顺序引用0..N个素材（仅引用关系）。
    - term: ProviderProfile
      definition: 可配置的外部/本地生成与分析能力配置项（不锁定具体服务实现细节），可设为默认并在生成时覆写。
    - term: Locale/Theme
      definition: 界面语言与主题/密度偏好（如中英切换、明暗主题、紧凑/舒适密度）。
    key_user_journeys:
    - id: J1
      name: 核心：生成并入库
      steps:
      - 用户输入需求（可含脚本/分镜描述/参考图）
      - （可选）用户选择角色（Character）与/或 Series/Project 上下文
      - 系统组装 PromptPack 快照
      - 用户提交生成并等待完成
      - 系统展示结果与运行信息
      - 系统按默认策略审核（自动通过+抽检；必要时人工覆写）
      - 资产入库并可追溯查看关联信息
    - id: J2
      name: 核心：浏览资产并追溯复用
      steps:
      - 用户在资产总览页查看全部图片/视频资产（无需先选Project/Series）
      - 打开资产详情查看关联信息与证据链
      - 从原始输入复用，形成新Run或新版本（概念层要求）
    constraints_from_user:
      usability:
      - 前端交互层级尽量浅（避免深层嵌套）
      - 高频操作支持批处理（批量选择/批量执行）
      - 关键状态清晰可见（运行中/失败/可重试/已入库）
  yaml_spec:
    scope:
      in:
      - id: S1
        name: 资产库管理（图片/视频）+ 总览页展示全部资产
        priority: P0
        includes:
        - 至少一个页面（首页或资产库页）可展示全部图片与视频资产（无需先选Project/Series）
        - 资产卡片展示关键字段，并提供进入资产详情的入口
        - 资产详情可查看关联信息与追溯入口（PromptPack/Run/Review/Project/Series/Shot 等概念级信息）
        - 支持删除（默认软删除）与回收站清空
        - 回收站支持还原已软删除资产（保留追溯关联）
        excludes:
        - 不做：多用户/权限/RBAC/协作
        - 不做：云端同步/共享资产库（本期）
        future_candidates:
        - 多用户/多设备同步
        - 更复杂的标签体系与检索推荐
        - AssetGrid 可选显示数量/密度切换（与主题/密度联动）
      - id: S2
        name: 四类生成入口（聊天式体验）
        priority: P0
        includes:
        - 支持文生图、图生图、文生视频、图生视频四类生成入口（需求层覆盖）
        - 支持“组装Prompt（可选）→最终Prompt（必有）”的提示词链路，并在证据链中可追溯
        - 输入可包含自然语言/脚本/分镜描述/参考图（概念层）
        - 生成结果默认保存到资产库并可追溯
        - 生成时可选择0..N个角色（Character），并将选择写入可追溯关联（需求层）
        excludes:
        - 不锁定：具体provider、模型选择与参数细化（由ARCH/实现决定）
        future_candidates:
        - 批量脚本化生成、模板化生成
      - id: S3
        name: 一致性/质量审核 + 证据链（Traceability）
        priority: P0
        includes:
        - 审核输出：face_consistency_score、style_consistency_score、quality_score、overall_pass、reasons[]（需求层语义冻结）
        - 支持自动通过 + 抽检；支持人工覆写并写入原因（入证据链）
        - 生成失败/审核未通过需记录原因并可重试，记录保留用于追溯
        excludes:
        - 不锁定：自动打分算法实现方式（可先人工/规则）
        future_candidates:
        - 更严格的自动评分与对比评测
      - id: S4
        name: 按Shot编排引用 + 加密导出/无导入预览/导入迁移（闭环）
        priority: P1
        includes:
        - 按Shot顺序编排：每个Shot引用0.N个素材（仅引用关系）
        - 导出为可加密目录包（含资产本体+元数据+证据链+编排清单）
        - 目录包无需导入即可浏览/预览（流式解密，最低预览能力由决策定义）
        - 可导入新项目迁移且保留关系与证据链一致性（需求层）
        excludes:
        - 不做：剪辑合成、转场、字幕、音轨、时间线渲染
        - 不锁定：加密/流式解密实现细节（由ARCH/实现决定）
        - 本期不优先扩展 Shot 相关能力（仅维持已交付范围）
        future_candidates:
        - 更丰富的时间线编辑/剪辑能力
      - id: S5
        name: 角色库（Character）管理与选择（人物一致性）
        priority: P0
        includes:
        - 创建/编辑角色档案（名称、简介、标签等最小字段）
        - 为角色上传参考素材集并进行“确认/可用”标记（见 D-008 门槛）
        - 在 Generate 中可选择角色并参与生成；结果资产可追溯到角色
        - 角色可被 Series/Project 引用（需求层；实现可先仅支持选择与显示）
        excludes:
        - 不做：模型训练/微调/LoRA训练管理
        - 不锁定：人物一致性算法与具体实现方式（可先基于人工/规则/外部工具）
        future_candidates:
        - 多角色关系图谱（家族/阵营/关系）
        - 基于历史资产的自动角色聚类与去重
      - id: S6
        name: 设置：ProviderProfile 默认值 + 语言/主题
        priority: P1
        includes:
        - 提供“设置”入口：管理 ProviderProfile（外部服务/本地工作流）并可设默认
        - Generate/Series/Project 可继承默认 ProviderProfile，且允许单次生成覆写
        - 界面支持中英双语（至少 zh-CN/en-US），并支持主题/密度切换
        excludes:
        - 不锁定：具体供应商SDK/模型名/参数面板
        - 不做：多用户个性化云同步
        future_candidates:
        - 更细粒度的模型/参数预设模板
        - 团队共享的配置中心（未来）
      - id: S7
        name: Series（系列）工作区（轻叙事/同风格内容线）
        priority: P2
        includes:
        - 创建系列并维护“系列简介”与“系列组装Prompt”（可为空）且具有版本历史可回溯
        - 系列内可浏览资产（图片/视频）并支持排序/筛选（复用资产库能力）
        - 系列生成：系统可基于系列信息与已保留资产给出“提示词建议/首帧/视频提示词”并支持手动确认后生成
        - 保留/不保留：不保留进入回收站且可还原；保留则纳入后续分析范围（需求层）
        excludes:
        - 不承诺：复杂剧情前后连续性（Series 不等同于剧集）
        - 不锁定：分析与学习算法细节（见 D-013）
        future_candidates:
        - 更强的自动化：自动产出每周/每日系列内容计划
        - 更复杂的标签体系与推荐
      - id: S8
        name: Projects（剧集/漫剧项目）工作区（强叙事/分集/分镜）
        priority: P3
        includes:
        - 创建项目并维护“项目简介/整体剧情介绍”（可更新，带历史）
        - 项目分析输出：分集设计、人物设计、风格设定、关键道具/场景设定（需求层对象，细节由ARCH/实现）
        - 按集/分镜进行可选的自动或手动流程：分镜设计→生成素材→组装（仅引用关系，不做剪辑渲染）
        - 整体一致性要求：剧情前后一致、人物一致、风格一致、动作与内容集成一致（需求层）
        excludes:
        - 不做：NLE级剪辑合成与渲染输出（转场/字幕/音轨/时间线渲染）
        - 不承诺：端到端全自动成片质量
        future_candidates:
        - 更完整的生产看板（排期/工时/协作）
        - 更丰富的动画/动作控制
      out:
      - id: O1
        name: 多用户登录 + RBAC
        reason: 本期单机单用户
      - id: O2
        name: NLE级剪辑合成与渲染输出
        reason: 只做素材编排与引用关系
      - id: O3
        name: 模型训练/微调/LoRA训练管理
        reason: 范围聚焦素材生产与管理闭环
      - id: O4
        name: 云端同步/共享资产库
        reason: 本期单机单用户
      - id: O5
        name: 复杂项目管理（排期/工时/看板）
        reason: 不在MVP范围
    users_and_operating_mode:
      collaboration_mode: single_user_local
      target_environments:
      - web
      - desktop
      ui_usability_constraints:
      - 核心任务（生成并查看结果）交互层级≤3
      - 高频操作支持批处理
      - 状态明确：运行状态、审核状态、入库状态清晰可见
    workflows:
    - id: WF1
      name: 生成并入库（Happy Path）
      steps:
      - 用户选择生成类型并提交
      - 系统展示运行状态（进行中/成功/失败）
      - 成功后展示结果与运行信息
      - 按默认策略审核（自动通过+抽检 或 人工覆写）
      - 资产入库并建立追溯关联
      exceptions:
      - id: EX-WF1-1
        condition: 生成失败
        expected_handling: 记录失败原因；允许重试；失败记录保留
      - id: EX-WF1-2
        condition: 审核未通过
        expected_handling: 记录原因；允许调整输入后重试；未通过记录保留
    - id: WF2
      name: 浏览资产并追溯复用
      steps:
      - 在总览页浏览全部资产并打开详情
      - 查看关联信息与证据链节点
      - 基于原始输入复用，形成新运行（概念层）
    - id: WF3
      name: 编排并导出/导入迁移
      steps:
      - 按Shot顺序编排引用（仅引用关系）
      - 导出可加密目录包
      - 无导入预览
      - 导入迁移并保持关系与证据链一致性（需求层）
    acceptance_criteria:
    - id: AC-001
      type: functional
      priority: P0
      title: 总览页可展示全部图片与视频并可进入详情
      gherkin:
        given: 系统中至少存在1个图片资产与1个视频资产
        when: 用户打开首页或资产库页面
        then: 用户能看到覆盖全部资产的列表（包含图片与视频），并能打开任意资产详情
    - id: AC-002
      type: functional
      priority: P0
      title: 资产详情具备关联信息与追溯入口
      gherkin:
        given: 存在一个已入库资产
        when: 用户打开资产详情
        then: 能看到关联的PromptPack、Run、Review，以及Project/Series/Shot信息（如有）
    - id: AC-003
      type: functional
      priority: P0
      title: 四类生成入口可发起生成且默认入库可追溯
      gherkin:
        given: 用户提供生成输入并选择生成类型
        when: 用户提交生成并等待完成
        then: 结果可见且默认入库，并可追溯到PromptPack与Run
    - id: AC-004
      type: functional
      priority: P0
      title: 审核输出量化分数与结论，支持自动通过+抽检与人工覆写留痕
      checklist:
      - 审核至少输出：face_consistency_score、style_consistency_score、quality_score、overall_pass、reasons[]
      - 通过项按默认比例抽检或标记通过；人工覆写必须填写原因并入证据链
    - id: AC-005
      type: usability
      priority: P1
      title: 浅层交互完成核心任务
      checklist:
      - 从首页完成“提交生成→查看结果”不超过3层页面/弹层
    - id: AC-006
      type: functional
      priority: P1
      title: 导出目录包可无导入预览并可导入迁移（需求层）
      checklist:
      - 导出后可无导入浏览/预览（最低预览能力见D-006）
      - 导入后关系与证据链不丢失
    - id: AC-007
      type: functional
      priority: P0
      title: 角色库可创建角色并在 Generate 中选择用于生成且可追溯
      checklist:
      - 用户可创建一个角色并上传满足 D-008 的参考集后标记为“已确认/可用”
      - 在 Generate 提交生成时可选择该角色；生成结果资产在详情中可见该角色关联（可点击/定位）
      - 未确认角色不可作为默认选择；但允许以“草稿角色”方式参与（需明确标识）
    - id: AC-008
      type: functional
      priority: P1
      title: Generate 的提示词链路可追溯：原始输入→（可选）组装Prompt→最终Prompt
      gherkin:
        given: 用户在 Generate 提交一次生成（可带或不带组装Prompt）
        when: 生成完成并打开结果资产详情
        then: 用户能看到该资产对应的原始输入、组装Prompt（如有）、最终Prompt 的可追溯引用关系
    - id: AC-009
      type: functional
      priority: P1
      title: 回收站支持还原已软删除资产
      gherkin:
        given: 存在一个被软删除的资产
        when: 用户在回收站对该资产执行“还原”
        then: 该资产回到默认资产列表中，并保持原有追溯关联不丢失
    - id: AC-010
      type: functional
      priority: P1
      title: 设置可管理 ProviderProfile，并在 Generate/Series/Project 继承默认值且可覆写
      checklist:
      - 用户可在设置中创建至少1个 ProviderProfile 并设为默认
      - Generate 默认使用该 ProviderProfile；用户可在单次生成中覆写为其它 ProviderProfile
      - Series/Project 可显示其继承的默认 ProviderProfile（需求层），并允许覆写（实现可先只支持显示）
    decisions:
    - id: D-001
      topic: Project/Series 是否必填
      decision: 允许为空，生成后再归档。
      rationale: 降低使用门槛，同时满足“总览页展示全部资产”。
      impact: 需要支持未归档资产展示/筛选/归档入口（需求层）。
      status: confirmed
    - id: D-002
      topic: 审核策略
      decision: 自动通过 + 抽检。
      rationale: 平衡效率与质量控制。
      impact: 需要抽检标记与覆写留痕。
      status: confirmed
    - id: D-003
      topic: 抽检比例
      decision: 通过项默认抽检 5%。
      rationale: MVP阶段以低成本发现问题。
      impact: 抽检策略需可调整（需求层可配置；实现由ARCH/后续决定）。
      status: confirmed
    - id: D-004
      topic: 分数标尺与通过规则
      decision: 分数范围 0.00–1.00；overall_pass = face>=0.80 AND style>=0.80 AND quality>=0.70。
      rationale: 提供可执行的最小质量门槛。
      impact: 需要在审核输出中体现分数与结论。
      status: confirmed
    - id: D-005
      topic: 删除策略
      decision: 软删除（回收站）+ 可清空。
      rationale: 防止误删且支持整理。
      impact: 默认列表需排除 deleted；回收站可查看并操作。
      status: confirmed
    - id: D-006
      topic: 无导入预览最低能力
      decision: 缩略图/代理预览 + 元数据与关系/证据链只读浏览；视频封面抽帧；不承诺全质量实时播放。
      rationale: 满足“交付可预览”但不引入重型播放/解密复杂度承诺。
      impact: 导出包需包含预览所需的最小代理信息（需求层）。
      status: confirmed
    - id: D-007
      topic: Generate 是否必须填写“组装Prompt”
      decision: 组装Prompt为可选；系统必须持久化原始输入与最终Prompt，且若存在组装Prompt也须可追溯。
      rationale: 降低使用门槛，同时保留高级用户的提示词工程能力。
      impact: 需要在证据链中区分“原始输入/组装Prompt/最终Prompt”，并支持缺省路径。
      status: confirmed
    - id: D-008
      topic: 角色确认所需参考素材门槛
      decision: 角色“已确认/可用”至少需要 8 张参考图片：正面/三分之二侧/侧面各≥1，且包含至少2种表情与2种光照；可选1段短视频作为补充。
      rationale: 以可操作的最小门槛提升人物一致性与可复用性。
      impact: 需要在角色档案中显示“参考集覆盖度”和确认状态；未达标只能为草稿。
      status: confirmed
    - id: D-009
      topic: 生成时角色选择的数量与语义
      decision: 每次生成允许选择0..N个角色，但必须标记 primary_character（默认1个）；多角色属于高级用法，系统只保证可追溯，不承诺一致性评分准确。
      rationale: 兼容单角与群像场景，同时避免在MVP阶段承诺复杂多角色一致性。
      impact: 审核与提示词建议需以 primary_character 为主；多角色场景可降低自动通过。
      status: confirmed
    - id: D-010
      topic: ProviderProfile 默认继承策略
      decision: 存在全局默认 ProviderProfile；Generate/Series/Project 默认继承全局默认，且单次生成可覆写。
      rationale: 减少重复配置，提高“即开即用”。
      impact: 需要在UI明确当前生效的 ProviderProfile 与覆写来源。
      status: confirmed
    - id: D-011
      topic: 语言支持范围
      decision: MVP 至少支持 zh-CN 与 en-US；语言切换为即时生效并在本地持久化。
      rationale: 覆盖核心用户与国际化基础。
      impact: 需要所有核心页面支持中英文案；缺失时需回退到默认语言。
      status: confirmed
    - id: D-012
      topic: 主题/密度默认
      decision: 默认 Light + Comfortable；支持 Light/Dark 与 Comfortable/Compact（至少2×2组合）。
      rationale: 满足长时间使用的可读性与信息密度偏好。
      impact: 需要关键组件在两种密度下不破版。
      status: confirmed
    - id: D-013
      topic: Series/Project 的“分析与学习”定位
      decision: '“分析与学习”定义为：系统基于（a）用户输入的简介/组装Prompt版本与（b）已保留资产的元数据/审核结果，生成可解释的建议输出（如提示词建议、风格要点、人物一致性提醒），并允许用户手动采纳。'
      rationale: 保持技术中立，确保人类在环与可控性。
      impact: 需要“建议输出”具备可追溯引用来源（引用了哪些版本/哪些资产）。
      status: confirmed
    non_functional_requirements:
      observability:
        requirements:
        - 必须存在 request_id 追踪概念（header 名由ARCH锁定）。
      performance:
        requirements:
        - 资产总览页与打开详情：用户操作后≤1s获得可见反馈（全量/分页策略由ARCH/实现决定）。
        - 生成任务状态：秒级刷新可接受；不要求逐帧实时。
      reliability:
        requirements:
        - 生成失败可重试且保留失败记录。
        - 证据链记录不可静默覆盖；复用产生新运行/新版本（概念层）。
      security:
        requirements:
        - 导出目录包必须可加密；密钥不得以明文形式与包一同存放。
      usability:
        requirements:
        - 核心任务（生成并查看结果）交互层级≤3。
        - 高频操作支持批处理。
      compatibility:
        requirements:
        - 目标环境：web/desktop（具体OS/浏览器清单由ARCH确定）。
      localization:
        requirements:
        - 中英切换不影响核心流程可用性；缺失文案需回退到默认语言。
        - 日期/数字格式遵循当前语言环境（需求层）。
    constraints:
      hard_stops:
      - 不得在需求阶段锁定数据库表结构、API字段名、具体库版本。
      - 冻结后只能通过 CR-L1 变更。
    assumptions:
    - 单机单用户。
    - MVP优先，后续通过CR演进。
    open_questions: []
    traceability:
      scope_to_workflows:
      - scope_id: S1
        workflow_ids:
        - WF2
      - scope_id: S2
        workflow_ids:
        - WF1
      - scope_id: S3
        workflow_ids:
        - WF1
        - WF2
      - scope_id: S4
        workflow_ids:
        - WF3
      - scope_id: S5
        workflow_ids:
        - WF1
        - WF2
      - scope_id: S6
        workflow_ids:
        - WF1
      - scope_id: S7
        workflow_ids:
        - WF1
        - WF2
      - scope_id: S8
        workflow_ids:
        - WF1
        - WF2
        - WF3
      scope_to_acceptance:
      - scope_id: S1
        acceptance_ids:
        - AC-001
        - AC-002
        - AC-009
      - scope_id: S2
        acceptance_ids:
        - AC-003
        - AC-008
      - scope_id: S3
        acceptance_ids:
        - AC-004
      - scope_id: S4
        acceptance_ids:
        - AC-006
      - scope_id: S5
        acceptance_ids:
        - AC-007
      - scope_id: S6
        acceptance_ids:
        - AC-010
  handoff_summary:
    spec_version: 1.1.0
    status: draft
    spec_sha256: <SPEC_SHA256_TBD>
    downstream_must_receive:
    - spec_version
    - status
    - spec_sha256
